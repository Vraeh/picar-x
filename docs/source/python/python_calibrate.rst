.. _py_calibrate:

PiCar-Xのキャリブレーション
=============================

モーターとサーボのキャリブレーション
---------------------------------------

PiCar-Xのインストール時やサーボの限界により、一部のサーボ角度がわずかに傾いている場合がありますので、それをキャリブレーションできます。

もちろん、組み立てが完璧でキャリブレーションが不要と思う場合、この章はスキップしても構いません。

#. ``calibration.py`` を実行します。

    .. raw:: html

        <run></run>

    .. code-block::

        cd ~/picar-x/example/calibration
        sudo python3 calibration.py

#. コードを実行すると、ターミナルに以下のインターフェースが表示されます。

    .. image:: img/calibrate1.png

#. ``R`` キーは、前輪の方向を制御するサーボが正常に動作し、損傷していないかどうかをテストするために使用します。

#. 数字キー ``1`` を押して前輪のサーボを選択し、 ``W/S`` キーを押して前輪が左右に傾かず、できるだけ前を向くようにします。

    .. image:: img/calibrate2.png

#. 数字キー ``2`` を押して **Panサーボ** を選択し、 ``W/S`` キーを押して、パン/チルトプラットフォームが直前を向き、左右に傾かないようにします。

    .. image:: img/calibrate3.png

#. 数字キー ``3`` を押して **tiltサーボ** を選択し、 ``W/S`` キーを押して、パン/チルトプラットフォームが直前を向き、上下に傾かないようにします。

    .. image:: img/calibrate4.png

#. インストール中にモーターの配線が逆になる可能性があるため、 ``E`` キーを押して車が正常に前進できるかどうかをテストします。そうでない場合、数字キー ``4`` および ``5`` を使用して左および右のモーターを選択し、 ``Q`` キーを押して回転方向をキャリブレーションします。

    .. image:: img/calibrate6.png

#. キャリブレーションが完了したら、 ``Spacebar`` を押してキャリブレーションパラメータを保存します。 ``y`` を入力して確認するプロンプトが表示され、 ``esc`` キーを押してプログラムを終了し、キャリブレーションを完了します。

    .. image:: img/calibrate5.png


グレースケールモジュールのキャリブレーション
--------------------------------------------------------

環境条件や照明状況の違いにより、グレースケールモジュールのプリセットパラメータが最適でない場合があります。このプログラムを通じてこれらの設定を微調整して、より良い結果を得ることができます。

#. 明るい色の床に約15cmの黒い電気テープの縞を置きます。PiCar-Xをテープの上に中央に配置します。このセットアップでは、グレースケールモジュールの中央のセンサーがテープの真上にあり、両側のセンサーが明るい表面の上に浮かび上がるべきです。

#. ``grayscale_calibration.py`` を実行します。

    .. raw:: html

        <run></run>

    .. code-block::

        cd ~/picar-x/example/calibration
        sudo python3 Grayscale.py

#. コードを実行すると、ターミナルに以下のインターフェースが表示されます。

    .. image:: img/calibrate_g1.png

#. "Q"キーを押してグレースケールのキャリブレーションを開始します。その後、PiCar-Xが左右にわずかな動きをするのを観察します。このプロセス中に、3つのセンサーのそれぞれが電気テープを少なくとも一度は掃除する必要があります。

#. さらに、"閾値"セクションには大幅に異なる値の3組が表示され、"ライン参照"にはこれらのペアのそれぞれの平均を表す2つの中間値が表示されます。

    .. image:: img/calibrate_g2.png

#. 次に、PiCar-Xを宙に浮かせて（または崖の端に配置して）"E"キーを押します。"cliff reference"の値もそれに応じて更新されることを観察します。

    .. image:: img/calibrate_g3.png

#. すべての値が正確であることを確認したら、"space"キーを押してデータを保存します。その後、Ctrl+Cを押してプログラムを終了できます。
